# Copyright Â© 2026 Intel Corporation. All rights reserved.
# SPDX-License-Identifier: Apache-2.0


services:
  aggregator-service:
    build:
      context: ./services/aggregator-service
      dockerfile: Dockerfile
    image: intel/hl-ai-aggregator-service:1.0.0
    container_name: aggregator-service
    environment:
      - WORKLOAD_TYPE=mdpnp
      - GRPC_PORT=50051
      - HTTP_PORT=8000
    network_mode: "host"

  mdpnp-service:
    build:
      context: ./services/mdpnp-service
      dockerfile: Dockerfile
    image: intel/hl-ai-mdpnp:1.0.0
    container_name: mdpnp-service
    network_mode: "host"

  dds-bridge:
    build:
      context: ./services/dds-bridge
      dockerfile: Dockerfile
    image: intel/hl-ai-dds-bridge:1.0.0
    container_name: dds-bridge
    environment:
      - GRPC_HOST=localhost
      - GRPC_PORT=50051
    depends_on:
      - mdpnp-service
      - aggregator-service
    network_mode: "host"

  ai-ecg:
    build:
      context: ./services/ai-ecg/backend
      dockerfile: Dockerfile
    image: intel/hl-ai-ecg:1.0.0
    container_name: ai-ecg
    network_mode: "host"

  3dpose-service:
      build:
        context: ./services/3d-pose-estimation
        dockerfile: src/Dockerfile
      image: intel/hl-ai-3dpose:1.0.0
      container_name: 3dpose-service
      network_mode: "host"
      environment:
        - VIDEO_FILE=/app/videos/face-demographics-walking.mp4
        - DEVICE=CPU
        - AGGREGATOR_ADDRESS=localhost:50051
        - CONTROL_PORT=8083
      depends_on:
        - aggregator-service

  metrics-service:
    build:
      context: ./services/metrics-service
      dockerfile: Dockerfile
    image: intel/hl-ai-metrics-service:1.0.0
    container_name: metrics-service
    privileged: true
    pid: host
    network_mode: "host"
    environment:
      - HTTP_PROXY=${HTTP_PROXY}
      - NPU_LOG=/tmp/results/npu_usage.csv
      - METRICS_DIR=/tmp/results
    volumes:
      - ./metrics:/tmp/results
      - /tmp/.X11-unix:/tmp/.X11-unix
      - /sys/devices:/sys/devices
      - /dev/dri:/dev/dri:rw
      - /sys/class/drm:/sys/class/drm:ro
      - /sys/kernel/debug:/sys/kernel/debug:ro
    devices:
      - "/sys:/sys"
      - "/dev:/dev"
      - "/run:/run"
      - "/proc:/proc"

  # rppg-web:
  #   build:
  #     context: ./services/rppg-web

 
  # ui-frontend:
  #   build:
  #     context: ./services/ui-frontend
  #   ports:
  #     - "3000:3000"   # example UI port

# no custom networks when using host networking mode

